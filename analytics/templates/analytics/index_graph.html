{%  extends 'base.html' %}
{% load static %}
{% block content %}
{% load widget_tweaks %}  <!-- load widget_tweaks -->

{% block extrahead %}
    {{ form.media.css }}
{% endblock %}
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

</head>
<body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
<!-- <script>
    $(document).ready(function() {
        var $select1 = $('#id_state_abv');

        $select1.on('change', function() {
            console.log('state_abv changed');
        });
    });
</script> -->
<form action="{% url 'index_graph' %}" method="post">
  {% csrf_token %}
  <div class="container">
      <div class="form-row">
          {% for field in form %}
          <div class="form-group col-md-4 col-lg-4 mb-3">
              <label for="{{ field.auto_id }}" class="d-block text-left">{{ field.label }}</label>
              {{ field|add_class:"form-control" }}
          </div>
          {% endfor %}
      </div>
      <div class="form-group row">
          <div class="col-sm-8">
              <input type="submit" class="btn btn-primary mt-2" value="Submit">
          </div>
      </div>
  </div>
</form>

{% block extrascripts %}
{{ form.media.js }}
    <script src="{% static 'django_select2/django_select2.js' %}"></script>
  
{% endblock %}
<!-- <script>
$(document).ready(function() {
    $('.django-select2').select2();
});
</script> -->


<title>Collapsible Rows</title>
<style>
  /* Basic styling for the collapsible rows */
  details {
    /* width: 1200px; */
    margin: 10px;
    border: 1px solid #ddd;
    /* padding: 5px; */
    overflow: hidden; /* Hide overflowing content */

  }
  summary {
    cursor: pointer;
    outline: none;
    padding: 10px;
    background-color: #f0f0f0;
    display: block;
    justify-content: space-between;
    align-items: center;
  }
  /* Styling for the + and - icons */
  summary::after {
    content: "+";
    font-size: 18px;
    float: right;
    margin-right: 10px;
  }
  details[open] summary::after {
    content: "-";
  }

  details[open] {
    overflow: auto; /* Show scrollbar when open */
    max-height: auto; /* Set a maximum height for open state */
  }

  .resizable-plot {
        max-width: 100%; /* Limit width to the available space */
        max-height: auto; /* Set a maximum height */
        overflow: auto; /* Add scrollbar if content overflows */
    }
  /* Remove the default list styles */
  #rowList {
    list-style: none;
    padding: 0;
    margin: 0;
    width: 100%;
  }
  .compare-by {
    height: 38px; /* Adjust this value as needed */
}
.select-info-container {
    position: relative;
}

#info-button-1 {
    position: absolute;
    right: 0;
}

  
  
  
</style>
</head>
<body>
  <div class="modal fade" id="infoModal" tabindex="-1" role="dialog" aria-labelledby="infoModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="infoModalLabel">Graph Information</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          This graph here represents the information about the school in every district of america
          <!-- Add your text content explaining the graph here -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  <ul id="rowList">
    <li>
      <details>
        <summary>{{plot_titles.plot1}}</summary>
        <div class="dropdown-container" id="dropdown-container-1">
        <div class="select-info-container">
        <select class="compare-by" id="compare-by-1">
          <option value="">Compare By...</option>
          <option value="imp_level">Implementation Level</option>
          <option value="locale">Locale</option>
          <option value="school_level">School Level</option>
          <!-- Add more options as needed -->
        </select>
        <button id="reset-button-1" class="btn btn-secondary">Reset</button>
        <button id="info-button-1" class="btn btn-info" data-toggle="modal" data-target="#infoModal">
          <i class="fas fa-question-circle"></i>
                </button>
      </div>
        <!-- Add a spinner element for the loader (hidden by default) -->
        <div id="loader" style="display: none;">
          <img src="{% static 'images/loader.gif' %}" alt="Loading...">
        </div>
        <div class="content">
        <div class="resizable-plot" id="resizable-plot-1"> {{plot1|safe}}</div>
         </div>
        </div>
      </details>
    </li>
    <li>
        <details>
            <summary>{{plot_titles.plot2}}</summary>
            <div class="content">
            <div class="resizable-plot"> {{plot2|safe}}</div>
            </div>
          </details>
    </li>
    <li>
        <details>
            <summary>{{plot_titles.plot3}}</summary>
            <div class="content">
            <div class="resizable-plot"> {{plot3|safe}}</div>
            </div>
          </details>
    </li>
    <li>
        <details>
            <summary>{{plot_titles.plot4}}</summary>
            
            <div class="content">
            <div class="resizable-plot"> {{plot4|safe}}</div>
            </div>
          </details>
    </li>
    <li>
        <details>
            <summary>{{plot_titles.plot5}}</summary>
            <div class="dropdown-container" id="dropdown-container-2">
              <select class="compare-by" id="compare-by-2">
                <option value="">Compare By...</option>
                <option value="imp_level">Implementation Level</option>
                <option value="locale">Locale</option>
                <option value="school_level">School Level</option>
                <!-- Add more options as needed -->
              </select>
              <button id="reset-button-2" class="btn btn-secondary">Reset</button>
      
              <!-- Add a spinner element for the loader (hidden by default) -->
              <div id="loader" style="display: none;">
                <img src="{% static 'images/loader.gif' %}" alt="Loading...">
              </div>
            <div class="content">
            <div class="resizable-plot" id="resizable-plot-2"> {{plot5|safe}}</div>
            </div>
          </details>
    </li>
    <li>
        <details>
            <summary>{{plot_titles.plot6}}</summary>
            <div class="dropdown-container" id="dropdown-container-3">
              <select class="compare-by" id="compare-by-3">
                <option value="">Compare By...</option>
                <option value="imp_level">Implementation Level</option>
                <option value="locale">Locale</option>
                <option value="school_level">School Level</option>
                <!-- Add more options as needed -->
              </select>
              <button id="reset-button-3" class="btn btn-secondary">Reset</button>
      
              <!-- Add a spinner element for the loader (hidden by default) -->
              <div id="loader" style="display: none;">
                <img src="{% static 'images/loader.gif' %}" alt="Loading...">
              </div>
            <div class="content">
            <div class="resizable-plot" id="resizable-plot-3"> {{plot6|safe}}</div>
            </div>
          </details>
    </li>
    <li>
        <details>
            <summary>{{plot_titles.plot7}}</summary>
            <div class="dropdown-container" id="dropdown-container-4">
              <select class="compare-by" id="compare-by-4">
                <option value="">Compare By...</option>
                <option value="imp_level">Implementation Level</option>
                <option value="locale">Locale</option>
                <option value="school_level">School Level</option>
                <!-- Add more options as needed -->
              </select>
              <button id="reset-button-4" class="btn btn-secondary">Reset</button>
      
              <!-- Add a spinner element for the loader (hidden by default) -->
              <div id="loader" style="display: none;">
                <img src="{% static 'images/loader.gif' %}" alt="Loading...">
              </div>
            <div class="content">
            <div class="resizable-plot" id="resizable-plot-4"> {{plot7|safe}}</div>
            </div>
          </details>
    </li>
    <li>
        <details>
            <summary>{{plot_titles.plot8}}</summary>
            <!-- <div class="dropdown-container" id="dropdown-container-4">
              <select class="compare-by" id="compare-by-5">
                <option value="">Compare By...</option>
                <option value="imp_level">Implementation Level</option>
                <option value="locale">Locale</option>
                <option value="school_level">School Level</option> -->
                <!-- Add more options as needed -->
              <!-- </select>
              <button id="reset-button-5" class="btn btn-secondary">Reset</button>
       -->
              <!-- Add a spinner element for the loader (hidden by default) -->
              <!-- <div id="loader" style="display: none;">
                <img src="{% static 'images/loader.gif' %}" alt="Loading...">
              </div> -->
            <div class="content">
            <div class="resizable-plot-5"> {{plot8|safe}}</div>
            </div>
          </details>
    </li>
  </ul>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script>
  $('#compare-by-1').change(function() {
      var selectedOption = $(this).val();
      var state_abv = $('#state_drop').val();
      var survey_taken_year = $('#survey_drop').val();

      console.log(selectedOption)
      if (selectedOption) {  // If an option is selected (not the placeholder)
          $.ajax({

              url: "{% url 'get_graph' %}",  // Replace with your URL pattern name
              data: {
                'state_abv': state_abv,
                'survey_taken_year': survey_taken_year,
                'type': selectedOption,
                'graph_no': 1

              },
              traditional: true,
              success: function(data) {
                // print("YOO NEW DATA", data)
                  // Replace the content of the plot with the received data
                  // You might need to adjust this part to match your actual data and plot element
                  $('#resizable-plot-1').html(data.plot_div);
              }
          });
      }
  });

  $('#compare-by-2').change(function() {
      var selectedOption = $(this).val();
      var state_abv = $('#state_drop').val();
      var survey_taken_year = $('#survey_drop').val();


      if (selectedOption) {  // If an option is selected (not the placeholder)
          $.ajax({

              url: "{% url 'get_graph' %}",  // Replace with your URL pattern name
              data: {
                'state_abv': state_abv,
                'survey_taken_year': survey_taken_year,
                'type': selectedOption,
                'graph_no': 5
              },
              traditional: true,
              success: function(data) {
                // print("YOO NEW DATA", data)
                  // Replace the content of the plot with the received data
                  // You might need to adjust this part to match your actual data and plot element
                  $('#resizable-plot-2').html(data.plot_div);
              }
          });
      }
  });

  $('#compare-by-3').change(function() {
      var selectedOption = $(this).val();
      var state_abv = $('#state_drop').val();
      var survey_taken_year = $('#survey_drop').val();


      if (selectedOption) {  // If an option is selected (not the placeholder)
          $.ajax({

              url: "{% url 'get_graph' %}",  // Replace with your URL pattern name
              data: {
                'state_abv': state_abv,
                'survey_taken_year': survey_taken_year,
                'type': selectedOption,
                'graph_no': 6
              },
              traditional: true,
              success: function(data) {
                // print("YOO NEW DATA", data)
                  // Replace the content of the plot with the received data
                  // You might need to adjust this part to match your actual data and plot element
                  $('#resizable-plot-3').html(data.plot_div);
              }
          });
      }
  });

  $('#compare-by-4').change(function() {
      var selectedOption = $(this).val();
      var state_abv = $('#state_drop').val();
      var survey_taken_year = $('#survey_drop').val();
      console.log(state_abv)

      if (selectedOption) {  // If an option is selected (not the placeholder)
          $.ajax({

              url: "{% url 'get_graph' %}",  // Replace with your URL pattern name
              data: {
                'state_abv': state_abv,
                'survey_taken_year': survey_taken_year,
                'type': selectedOption,
                'graph_no': 7
              },
              traditional: true,
              success: function(data) {
                // print("YOO NEW DATA", data)
                  // Replace the content of the plot with the received data
                  // You might need to adjust this part to match your actual data and plot element
                  $('#resizable-plot-4').html(data.plot_div);
              }
          });
      }
  });

  $('#compare-by-5').change(function() {
      var selectedOption = $(this).val();
      var state_abv = $('#state_drop').val();
      var survey_taken_year = $('#survey_drop').val();


      if (selectedOption) {  // If an option is selected (not the placeholder)
          $.ajax({

              url: "{% url 'get_graph' %}",  // Replace with your URL pattern name
              data: {
                'state_abv': state_abv,
                'survey_taken_year': survey_taken_year,
                'type': selectedOption,
                'graph_no': 8
              },
              traditional: true,
              success: function(data) {
                // print("YOO NEW DATA", data)
                  console.log(data)
                  // Replace the content of the plot with the received data
                  // You might need to adjust this part to match your actual data and plot element
                  $('#resizable-plot-5').html(data.plot_div);
              }
          });
      }
  });

 

  // Handle the click event for the reset button
$('#reset-button-1').click(function() {
  // Show the loader
  $('#loader').show();
  var state_abv = $('#state_drop').val();
      var survey_taken_year = $('#survey_drop').val();


  // Make the AJAX request
  $.ajax({
    url: "{% url 'get_graph' %}",
    data: {
      // 'state_abv': ["AK"],
      // 'survey_taken_year': ['2022'],
      // 'type': 'reset'  // Indicate that this is a reset request
      'state_abv': state_abv,
      'survey_taken_year': survey_taken_year,
      'type': 'reset',
      'graph_no': 1
    },
    traditional: true,
    success: function(data) {
      // Hide the loader
      console.log("something!")
      $('#loader').hide();
      $('#compare-by-1').val('');

      // Replace the content of the plot with the received data
      $('#resizable-plot-1').html(data.plot_div);
    }
  });
});

$('#reset-button-2').click(function() {
  // Show the loader
  $('#loader').show();
  var state_abv = $('#state_drop').val();
      var survey_taken_year = $('#survey_drop').val();


  // Make the AJAX request
  $.ajax({
    url: "{% url 'get_graph' %}",
    data: {
      // 'state_abv': ["AK"],
      // 'survey_taken_year': ['2022'],
      // 'type': 'reset'  // Indicate that this is a reset request
      'state_abv': state_abv,
      'survey_taken_year': survey_taken_year,      'type': 'reset',
      'graph_no': 5
    },
    traditional: true,
    success: function(data) {
      // Hide the loader
      console.log("something!")
      $('#loader').hide();
      $('#compare-by-2').val('');

      // Replace the content of the plot with the received data
      $('#resizable-plot-2').html(data.plot_div);
    }
  });
});

$('#reset-button-3').click(function() {
  // Show the loader
  $('#loader').show();
  var state_abv = $('#state_drop').val();
      var survey_taken_year = $('#survey_drop').val();
  // Make the AJAX request
  $.ajax({
    url: "{% url 'get_graph' %}",
    data: {
      // 'state_abv': ["AK"],
      // 'survey_taken_year': ['2022'],
      // 'type': 'reset'  // Indicate that this is a reset request
      'state_abv': state_abv,
      'survey_taken_year': survey_taken_year,      'type': 'reset',
      'graph_no': 6
    },
    traditional: true,
    success: function(data) {
      // Hide the loader
      console.log("something!")
      $('#loader').hide();
      $('#compare-by-3').val('');

      // Replace the content of the plot with the received data
      $('#resizable-plot-3').html(data.plot_div);
    }
  });
});

$('#reset-button-4').click(function() {
  // Show the loader
  $('#loader').show();
  var state_abv = $('#state_drop').val();
      var survey_taken_year = $('#survey_drop').val();
  // Make the AJAX request
  $.ajax({
    url: "{% url 'get_graph' %}",
    data: {
      // 'state_abv': ["AK"],
      // 'survey_taken_year': ['2022'],
      // 'type': 'reset'  // Indicate that this is a reset request
      'state_abv': state_abv,
      'survey_taken_year': survey_taken_year,      'type': 'reset',
      'graph_no': 7
    },
    traditional: true,
    success: function(data) {
      // Hide the loader
      $('#loader').hide();
      $('#compare-by-4').val('');

      // Replace the content of the plot with the received data
      $('#resizable-plot-4').html(data.plot_div);
    }
  });
});


$(document).ready(function() {
    $('#state_drop').change(function() {
        var state = $(this).val();
        console.log(state);
        $.ajax({
            url: '/get_zipcodes/',
            data: {
                'state_abv': state
            },
            dataType: 'json',
            success: function(data) {
                var select = $('#postalCode_drop');
                select.empty();
                console.log(data)
                let entries = Object.entries(data);  // Convert the dictionary to an array of [key, value] pairs
                entries.reverse();  // Reverse the array
                console.log(entries)

                for (let [key, value] of entries) {
                    $('<option>').val(value).text(value).appendTo(select);
                };
            }
        });
    });

    });


  </script>
</body>
</html>

{% endblock %}
