{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    
    <title>Special Olympics</title>

    <!-- Custom fonts for this template-->
    <link href="{% static 'vendor/fontawesome-free/css/all.min.css' %}" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">

    <!-- Custom styles for this template-->
    <link href="{% static 'css/sb-admin-2.min.css' %}" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    
    <style>
        /* Add custom CSS here */
        #sidebar-wrapper {
        position: fixed;
        top: 0;
        left: 0;
        z-index: 3;
        height: 100%;
        }
/* 
        #topbar-wrapper {
            position: relative;
            top: 0;
            left: 0;
            width: 100%;
            background-color: #fff;
            z-index: 2;
        } */

        #content-wrapper {
            margin-left: 100px; /* Adjust this value based on your sidebar width */
            margin-top: 0;
            margin-right: 20px;
            width: 100%;
        }

        
        #content {
            position: relative;

            max-width: 100%;

            overflow-x: hidden;
        }

    </style>

    <!-- Toastr CSS -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet" />

<!-- Toastr JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

<!-- jQuery (Ensure this is loaded before Toastr) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<!-- Bootstrap CSS -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" />

<!-- Bootstrap JS and Popper.js for modals -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>


</head>

<body id="page-top">
    <div id="wrapper">
        <div id="sidebar-wrapper">
            {%include 'partials/_sidebar.html'%}
        </div>
        <div id="content-wrapper">
            <div id="topbar-wrapper">
            <!-- Topbar -->
                 {%include 'partials/_topbar.html'%}
            <!-- End of Topbar -->
             </div>

            <!-- Main Content -->
            <div id="content">
                <div class="container-fluid">
                    <div class="d-sm-flex align-items-center justify-content-between mb-4">
                        <h1 class="h3 mb-0 text-gray-800">Dashboard</h1>
                    </div>
                    <!-- Page Heading -->

                    <div class='row'>
                        {% block content%}
                        {% endblock %}
                    </div>
                </div>
            </div>
            <!-- End of Main Content -->

            <!-- Footer -->
            <!-- {%include 'partials/_footer.html'%} -->
            <!-- End of Footer -->
        </div>
        <!-- End of Content Wrapper -->
    </div>
    <!-- End of Page Wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>

    <!-- Logout Modal-->
    <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">Ã—</span>
                    </button>
                </div>
                <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                    <a class="btn btn-primary" href="../auth/login">Logout</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap core JavaScript-->
    <script src="{% static 'vendor/jquery/jquery.min.js' %}"></script>
    <script src="{% static 'vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>

    <!-- Core plugin JavaScript-->
    <script src="{% static 'vendor/jquery-easing/jquery.easing.min.js' %}"></script>

    <!-- Custom scripts for all pages-->
    <script src="{% static 'js/sb-admin-2.min.js' %}"></script>

    <!-- Page level plugins -->
    <script src="{% static 'vendor/chart.js/Chart.min.js' %}"></script>

    <!-- Page level custom scripts -->
    <script src="{% static 'js/demo/chart-area-demo.js' %}"></script>
    <script src="{% static 'js/demo/chart-pie-demo.js' %}"></script>
    <div class="modal fade" id="pdfModal" tabindex="-1" role="dialog" aria-labelledby="pdfModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document" style="max-width: 90%;">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="pdfModalLabel">Walkthrough</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <object data="{% static 'Walkthrough.pdf' %}" type="application/pdf" width="100%" height="500px">
                        <p>It appears you don't have a PDF plugin for this browser. You can <a href="{% static 'Walkthrough.pdf' %}">click here to download the PDF file.</a></p>
                    </object>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <iframe name="hiddenFrame" width="0" height="0" border="0" style="display: none;"></iframe>
    <div class="modal fade" id="feedbackModal" tabindex="-1" role="dialog" aria-labelledby="feedbackModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="feedbackModalLabel">Feedback</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Feedback form goes here -->
                    <form method="post" action="{% url 'handle_form_submission' %}" target="hiddenFrame">
                        <div class="form-group">
                        <div class="form-group">
                            <label for="requestor">Requestor</label>
                            <input type="text" class="form-control" id="requestor" name="requestor" placeholder="Enter Requestor">
                        </div>
                        <div class="form-group">
                            <label for="requestType">Request Type</label>
                            <select class="form-control" id="requestType" name="requestType">
                                <option>Feature request</option>
                                <option>Problem</option>
                                <option>Question</option>
                                <!-- <option>Refund</option> -->
                            </select>
                        </div>
                        <label for="feedbackTitle">Subject</label>
                        <input type="text" class="form-control" id="feedbackTitle" name="feedbackTitle" placeholder="Enter Subject">
                    </div>

                        <div class="form-group">
                            <label for="feedbackDescription">Description</label>
                            <textarea class="form-control" id="feedbackDescription" name="feedbackDescription" rows="3" placeholder="Enter description"></textarea>
                        </div>                        <button type="submit" class="btn btn-primary">Submit</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

        <!-- Modal for Upload Document -->
        <!-- Modal for Upload Document -->
        <div class="modal fade" id="uploadModal" tabindex="-1" role="dialog" aria-labelledby="uploadModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="uploadModalLabel">Import Data</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form  method="post" enctype="multipart/form-data" action="{% url 'upload' %}">
                            {% csrf_token %}
                            <div class="form-group">
                                <label for="csvFile">Upload CSV File</label>
                                <input type="file" class="form-control-file" id="csvFile" name="document" accept=".csv" required>
                            </div>
                            <div class="form-group">
                                <label for="yearSelect">Select Year</label>
                                <select class="form-control" id="yearSelect" name="year" required>
                                    <option value="2024">2024</option>
                                    <option value="2023">2023</option>
                                    <option value="2022">2022</option>
                                    <option value="2021">2021</option>
                                    <option value="2020">2020</option>
                                    <option value="2019">2019</option>
                                    <option value="2018">2018</option>
                                    <!-- Other year options -->
                                </select>
                            </div>
                            <button type="submit" id="submitUploadButton" class="btn btn-primary">Submit</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Success Message -->
        <div id="successMessage" class="alert alert-success" style="display:none;">
            File uploaded successfully!
        </div>
        
</body>

</html>

<link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

<script>
   $(document).ready(function() {
    var form = $('#feedbackModal form');  // Store the form in a variable

    form.on('submit', function(e) {
        e.preventDefault();

        var submitButton = $(this).find('button[type="submit"]');
        var originalButtonHtml = submitButton.html();  // Save the original button content

        // Show the loader on the submit button
        submitButton.html('Loading...');

        $.ajax({
            url: $(this).attr('action'),  // Get the action attribute of the form
            type: 'POST',
            data: $(this).serialize(),  // Serialize the form data for the AJAX request
            success: function(response) {
                // The request was successful, show a notification
                if (response === 'Form submitted successfully') {
                    toastr.success('Feedback sent successfully');
                    $('#feedbackModal').modal('hide');  // Close the feedback modal
                } else {
                    toastr.error('Failed to send feedback');
                }
            },
            error: function() {
                // The request failed, show an error notification
                toastr.error('Failed to send feedback');
            },
            complete: function() {
                // Restore the original button content
                submitButton.html(originalButtonHtml);
            }
        });
    });

    // Clear the form fields when the feedback modal is closed
    $('#feedbackModal').on('hidden.bs.modal', function(e) {
        form[0].reset();
    });
});


//submit Upload Button
   // Submit Upload Button with Loader
// Submit Upload Button with Loader
$('#submitUploadButton').click(function(e) {
    e.preventDefault();  // Prevent the default form submission
    
    var form = $('#uploadModal form'); // Form in the modal
    var submitButton = $(this);  // The submit button
    var originalButtonHtml = submitButton.html();  // Save the original button content
    
    // Display an informational message to the user
    toastr.info('Uploading document. This might take a couple of minutes...');
    
    // Show a loader inside the button
    submitButton.html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Uploading...');

    // Create a FormData object from the form
    var formData = new FormData(form[0]);
    
    $.ajax({
        url: form.attr('action'),  // The URL to submit the form data to
        type: form.attr('method'),  // The HTTP method to use
        data: formData,
        contentType: false,  // Necessary for file uploads
        processData: false,  // Necessary for file uploads
        success: function(response) {
            // On success, display the message from the server
            if (response.message) {
                toastr.success(response.message);
            } else {
                toastr.success('File uploaded successfully! Please refresh the page');
            }
            $('#uploadModal').modal('hide');  // Hide the modal
            // Reset the form fields
            form[0].reset();

            // Remove the backdrop manually (optional, Bootstrap should do this automatically)
            $('.modal-backdrop').remove();
        },
        error: function(xhr, status, error) {
            // On error, display the message from the server
            var errorMessage = 'Failed to upload file. Please try again.';
            if (xhr.responseJSON && xhr.responseJSON.message) {
                errorMessage = xhr.responseJSON.message;
            }
            toastr.error(errorMessage);
        },
        complete: function() {
            // Restore the original button content after the request completes
            submitButton.html(originalButtonHtml);
        }
    });
});

    </script>